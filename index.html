<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>è¬è§£ãã‚¢ãƒ—ãƒªç¬¬ï¼”å¼¾ï¼šã¨ã†ã›ã„ã®è¬</title>
<style>
  :root{
    --bg:#fff7fb; --card:#ffffff; --text:#1f2937; --muted:#6b7280;
    --accent:#ff7ac6; --ok:#16a34a; --ng:#ef4444; --ring:#ffd5ec;
    --gold:#ffcc66; --spark:#fff2a8;
  }
  html,body{height:100%}
  body{
    margin:0; background:linear-gradient(180deg,#fff7fb 0%, #f5fbff 100%);
    color:var(--text);
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,Arial,sans-serif;
    -webkit-tap-highlight-color:transparent;
  }
  .wrap{max-width:900px; margin:0 auto; padding:20px 16px 64px;}
  header{display:flex; align-items:center; gap:12px; margin:6px 0 10px;}
  header h1{font-size:26px; margin:0;}
  .mascot{width:40px; height:40px; border-radius:12px; box-shadow:0 6px 16px rgba(0,0,0,.08);}
  .card{background:var(--card); border-radius:20px; box-shadow:0 10px 24px rgba(255,122,198,.15);
        padding:18px; margin:14px 0; border:2px solid var(--ring);}
  .question{font-size:20px; font-weight:800; margin:8px 0 4px;}
  .lead{color:var(--muted); margin-top:2px;}
  .choices{display:grid; gap:10px; margin-top:12px;}
  .choice-btn{width:100%; text-align:left; padding:14px 16px; border-radius:16px; border:2px solid #e7f2ff; background:#fff; cursor:pointer; font-size:16px;}
  .choice-btn:hover{border-color:#cfe7ff; background:#f7fbff;}
  .result{margin-top:10px; font-weight:900; font-size:18px;}
  .ok{color:var(--ok);} .ng{color:var(--ng);}
  .subtitle{font-weight:900; color:#1f2937; margin:6px 0 10px; font-size:18px;}
  .muted-box{background:#fff5fa; border:2px dashed #ffd2ea; padding:10px 12px; border-radius:14px; color:#374151;}
  .explain{margin-top:12px; text-align:left; background:#f7fbff; border:2px solid #dbeafe; border-radius:14px; padding:12px;}
  .fade{animation:fade .25s ease;}
  @keyframes fade{from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:none}}
  @media (max-width:560px){
    header h1{font-size:22px}
    .question{font-size:18px}
    .choice-btn{font-size:15px; padding:14px}
    .btn{width:100%}
  }

  .btn{
    display:inline-block; padding:14px 18px; border-radius:16px; border:none; cursor:pointer; font-size:16px;
    background:linear-gradient(90deg,var(--accent),#ffa7d8); color:#fff; box-shadow:0 8px 18px rgba(255,122,198,.35);
  }
  .btn:disabled{opacity:.6; cursor:not-allowed;}
  .btn.alt{background:linear-gradient(90deg,#8ec5ff,#b5e1ff);}
  .btn.ghost{ background:#fff; color:#ff4fae; border:2px solid #ffb4df; box-shadow:none; }

  .form-vertical{display:flex; flex-direction:column; gap:12px;}
  label{font-size:14px; color:#6b7280; margin-bottom:6px;}
  input{
    width:100%; padding:14px 14px; font-size:16px; border-radius:14px; border:2px solid #ffdff0; background:#fff; outline:none;
  }
  input:focus{border-color:#ffb3dc; box-shadow:0 0 0 4px #ffe6f4;}

  .hero{
    display:flex; flex-direction:column; align-items:center; text-align:center; gap:10px;
  }
  .hero img{ width:min(68vw, 300px); height:auto; border-radius:24px; box-shadow:0 10px 26px rgba(0,0,0,.12); }

  .speech{
    background:#ffffff; border:2px solid #ffd5ec; border-radius:18px; padding:12px 14px; line-height:1.7;
    position:relative; max-width:680px;
  }
  .speech:after{content:""; position:absolute; top:100%; left:50%; transform:translateX(-50%);
    border:10px solid transparent; border-top-color:#ffd5ec;}
  .speech:before{content:""; position:absolute; top:calc(100% + 2px); left:50%; transform:translateX(-50%);
    border:10px solid transparent; border-top-color:#ffffff;}

  .type-line{min-height:1.8em; white-space:pre-wrap; line-height:1.9;}
  .pause-dot{animation:blink 1.4s ease-in-out infinite;}
  @keyframes blink{0%,100%{opacity:.2} 50%{opacity:1}}

  .stamp{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(255,255,255,.75); z-index:50;}
  .stamp img{width:min(70vw,380px); height:auto; filter:drop-shadow(0 10px 24px rgba(0,0,0,.2)); animation:pop .5s ease;}
  @keyframes pop{0%{transform:scale(.6) rotate(-6deg); opacity:0}60%{transform:scale(1.05) rotate(2deg); opacity:1}100%{transform:scale(1) rotate(0)}}

  #screen-ending{ position:relative; overflow:hidden; }
  .ending-wrap{ display:flex; flex-direction:column; align-items:center; gap:12px; text-align:center; }
  .ending-title{
    font-size:24px; font-weight:900; letter-spacing:.02em;
    background:linear-gradient(90deg,#ff7ac6,#ffcc66); -webkit-background-clip:text; background-clip:text; color:transparent;
  }
  .ending-lines{
    line-height:1.9; font-size:16px; color:#374151;
    background:#fffef3; border:2px solid #ffefb6; border-radius:16px; padding:10px 14px;
  }
  .ending-badge{
    display:inline-block; padding:8px 12px; border-radius:999px;
    background:linear-gradient(90deg,#ffd591,#ffe9b6); color:#6b4000; font-weight:800; font-size:13px;
    border:1px solid #f6c66f; box-shadow:0 6px 16px rgba(255,204,102,.35);
  }
  .ending-actions{ display:flex; gap:10px; margin-top:6px; flex-wrap:wrap; justify-content:center; }

  .confetti{ pointer-events:none; position:absolute; inset:0; overflow:hidden; }
  .confetti span{
    position:absolute; top:-10px; width:10px; height:16px; opacity:.9;
    animation:fall 2.8s linear forwards; transform:rotate(0deg);
  }
  @keyframes fall{0%{ transform:translateY(-10px) rotate(0deg);}100%{ transform:translateY(120vh) rotate(540deg);} }
  .sparkles{ pointer-events:none; position:absolute; inset:0; }
  .spark{
    position:absolute; width:10px; height:10px; background:radial-gradient(circle, var(--spark) 0%, rgba(255,255,255,0) 70%);
    animation:blink 1.6s ease-in-out infinite;
  }

  /* æ˜Ÿåº§é¸æŠç”¨ */
  .zodiac-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
    gap:8px; margin-top:10px;
  }
  .zodiac-btn{
    padding:10px 12px; border-radius:14px; border:2px solid #ffe0f2;
    background:#ffffff; cursor:pointer; font-size:14px; text-align:center; line-height:1.4;
  }
  .zodiac-btn span{display:block; font-size:12px; color:#9ca3af;}
  .zodiac-btn:hover{background:#fff7fc; border-color:#ffb3dc;}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="mame2.png" alt="ã¨ã›ã„ãã‚“ï¼ˆç¬¬4å¼¾ï¼‰" class="mascot" />
      <h1>ç¬¬ï¼”å¼¾ï¼šã¨ã†ã›ã„ã®è¬</h1>
    </header>

    <!-- 1ãƒšãƒ¼ã‚¸ç›®ï¼šã‚ˆã†ã“ãï¼†ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ› -->
    <section id="screen-intro" class="card fade">
      <div class="hero">
        <img src="mame2.png" alt="ã¨ã›ã„ãã‚“ï¼ˆç¬¬4å¼¾ï¼‰" />
        <div class="speech">
          <strong>ã¼ãã¯ ã¨ã›ã„ãã‚“ã€‚</strong><br>
          <strong>TMC(ã¨ã†ã›ã„ãƒ¡ãƒ‡ã‚£ã‚«ãƒ«ã‚«ãƒƒãƒ—ï¼‰ã®ãƒã‚¹ã‚³ãƒƒãƒˆã‚­ãƒ£ãƒ©ã ã‚ˆã€‚</strong><br>
          <strong>ç¬¬ï¼”å¼¾ ã¨ã†ã›ã„ã®è¬</strong>ã¸ã‚ˆã†ã“ãï¼<br>
          ã¾ãšã¯ã‚ãªãŸã®ã“ã¨<strong>æ•™ãˆã¦ï¼</strong>
        </div>
      </div>

      <div style="height:8px;"></div>

      <div class="form-vertical">
        <div>
          <label for="name">åå‰</label>
          <input id="name" type="text" placeholder="ä¾‹ï¼‰ãƒ•ãƒ«ãƒãƒ¼ãƒ " />
        </div>
        <div>
          <label for="group">æ‰€å±</label>
          <input id="group" type="text" placeholder="ä¾‹ï¼‰å¤–æ¥ï¼ã€‡ã€‡ç—…æ£Ÿï¼ãƒªãƒ ãªã©" />
        </div>
        <div>
          <label for="job">è·ç¨®</label>
          <input id="job" type="text" placeholder="ä¾‹ï¼‰çœ‹è­·å¸«ï¼åŒ»å¸«ï¼è–¬å‰¤å¸« ãªã©" />
        </div>
      </div>

      <div style="margin-top:16px;">
        <button class="btn" onclick="goPre()">æ¬¡ã¸</button>
      </div>
    </section>

    <!-- 2ãƒšãƒ¼ã‚¸ç›®ï¼šãŠçŸ¥ã‚‰ã›ï¼ˆã‚¿ã‚¤ãƒ—ãƒ©ã‚¤ã‚¿ãƒ¼æ¼”å‡ºï¼‰ -->
    <section id="screen-announce" class="card fade" style="display:none;">
      <div class="hero">
        <img src="toseikirakira.png" alt="ã‚­ãƒ©ã‚­ãƒ©ã¨ã›ã„ãã‚“" />
        <div class="speech">
          <div id="typeL1" class="type-line"></div>
          <div id="typeL2" class="type-line" style="margin-top:6px;"></div>
          <div id="typeL3" class="type-line" style="margin-top:6px;"></div>
        </div>
      </div>
      <div style="margin-top:14px; text-align:center;">
        <button id="to-zodiac-btn" class="btn" onclick="toZodiac()" disabled>æ¬¡ã¸</button>
      </div>
    </section>

    <!-- 3ãƒšãƒ¼ã‚¸ç›®ï¼šæ˜Ÿåº§é¸æŠç”»é¢ï¼ˆç”»åƒè¿½åŠ ï¼‰ -->
    <section id="screen-zodiac" class="card fade" style="display:none;">
      <div class="hero" style="margin-top:6px;">
        <img src="toseiuranai2.png" alt="æ˜Ÿå ã„ã‚’ã™ã‚‹ ã¨ã›ã„ãã‚“" class="tarot-hero" />
      </div>
      <div class="muted-box" style="margin:10px 0 14px; line-height:1.9;">
        <p><strong>ä»Šå¹´ã‚‚æ®‹ã‚Šã‚ãšã‹ã«ãªã£ã¦ããŸã­ã€‚</strong></p>
        <p>ä»Šå¹´ã®æ®‹ã‚Šã®<strong>æ˜Ÿå ã„</strong>ã‚’ã—ã¡ã‚ƒãŠã†</p>
        <p><strong>æ˜Ÿåº§ã‚’æ•™ãˆã¦</strong>ã­ã€‚</p>
      </div>
      <div class="zodiac-grid">
        <button class="zodiac-btn" onclick="selectZodiac('aries')">ãŠã²ã¤ã˜åº§<span>Aries</span></button>
        <button class="zodiac-btn" onclick="selectZodiac('taurus')">ãŠã†ã—åº§<span>Taurus</span></button>
        <button class="zodiac-btn" onclick="selectZodiac('gemini')">ãµãŸã”åº§<span>Gemini</span></button>
        <button class="zodiac-btn" onclick="selectZodiac('cancer')">ã‹ã«åº§<span>Cancer</span></button>
        <button class="zodiac-btn" onclick="selectZodiac('leo')">ã—ã—åº§<span>Leo</span></button>
        <button class="zodiac-btn" onclick="selectZodiac('virgo')">ãŠã¨ã‚åº§<span>Virgo</span></button>
        <button class="zodiac-btn" onclick="selectZodiac('libra')">ã¦ã‚“ã³ã‚“åº§<span>Libra</span></button>
        <button class="zodiac-btn" onclick="selectZodiac('scorpio')">ã•ãã‚Šåº§<span>Scorpio</span></button>
        <button class="zodiac-btn" onclick="selectZodiac('sagittarius')">ã„ã¦åº§<span>Sagittarius</span></button>
        <button class="zodiac-btn" onclick="selectZodiac('capricorn')">ã‚„ãåº§<span>Capricorn</span></button>
        <button class="zodiac-btn" onclick="selectZodiac('aquarius')">ã¿ãšãŒã‚åº§<span>Aquarius</span></button>
        <button class="zodiac-btn" onclick="selectZodiac('pisces')">ã†ãŠåº§<span>Pisces</span></button>
      </div>
    </section>

    <!-- 4ãƒšãƒ¼ã‚¸ç›®ï¼šæ˜Ÿå ã„çµæœï¼ˆå‰ã®æ§‹æˆã‚’ç¶™æ‰¿ï¼‰ -->
    <section id="screen-diag-result" class="card fade" style="display:none;">
      <div id="type-title" class="question">ã¨ã›ã„ãã‚“ã®æ˜Ÿåº§å ã„</div>
      <div id="type-copy" class="lead"></div>

      <div class="hero" style="margin-top:8px;">
        <img src="mame2.png" alt="æ˜Ÿã‚’è¦‹ã‚‹ã¨ã›ã„ãã‚“" class="tarot-hero" />
      </div>

      <div class="fortune-lines" id="fortune-lines" style="margin-top:10px;"></div>
      <div id="advice-title" class="advice-title" style="display:none; margin-top:12px;">
        ğŸ”­ 2025å¹´12æœˆã®ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ãƒ‰ãƒã‚¤ã‚¹
      </div>
      <ul id="type-desc" style="text-align:left; line-height:1.8; margin-top:8px;"></ul>

      <div class="muted-box" style="margin-top:14px;">
        ã§ã¯<strong>è¬è§£ãç¬¬ï¼”å¼¾</strong>ã‚’å§‹ã‚ã‚ˆã†ï¼
      </div>
      <button class="btn" onclick="toQuiz()" style="margin-top:12px;">ç¬¬1å•ã¸é€²ã‚€</button>
    </section>

    <!-- 5ã€œ7ãƒšãƒ¼ã‚¸ç›®ï¼šã‚¯ã‚¤ã‚ºï¼ˆ3å•ï¼‰ -->
    <section id="screen-quiz" class="card fade" style="display:none;">
      <!-- â˜… ã‚¯ã‚¤ã‚ºæœ€åˆã®ç”»é¢ã«è¡¨ç¤ºã™ã‚‹å‰ç½®ãï¼ˆ1å•ç›®ã®ã¿è¡¨ç¤ºï¼‰ -->
      <div id="quiz-prologue" class="muted-box" style="margin-bottom:10px; display:none; text-align:left; line-height:1.9;">
        <p><strong>æ˜Ÿåº§å ã„ã¯ã©ã†ã ã£ãŸï¼Ÿ</strong></p>
        <p>åƒ•ã¯<strong>èŸ¹åº§</strong>ãªã‚“ã ã‘ã©ã€èŸ¹åº§ã£ã¦è‹±èªã§è¨€ã†ã¨ãªã‚“ã¦èª­ã‚€ã‹çŸ¥ã£ã¦ã‚‹ï¼Ÿï¼Ÿ</p>
        <p>ãã†ï¼ <strong>ã€ŒCancerï¼ˆã‚­ãƒ£ãƒ³ã‚µãƒ¼ï¼‰ã€</strong>ã€€ã‚ã‚Œã‚Œâ€¦ãªã‚“ã‹ã©ã“ã‹ã§èã„ãŸã“ã¨ã‚ã‚‹ç—…æ°—ã¨åŒã˜ã â€¦</p>
        <p>ä»Šã‚„<strong>2äººã«1äººãŒç½¹ã‚‹</strong>ã¨è¨€ã‚ã‚Œã¦ã‚‹ã€Œç™Œã€ã¨åŒã˜ãªã‚“ã ã‚ˆã­ã€‚</p>
        <p>ä¹³ç™Œã®ã—ã“ã‚ŠãŒã€èŸ¹ãŒå¼µã‚Šä»˜ã„ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ã“ã¨ã‹ã‚‰<strong>ã€ŒèŸ¹ã€</strong>ã‚’æ„å‘³ã™ã‚‹ã‚®ãƒªã‚·ãƒ£èªãŒèªæºã ã£ã¦è©±ï¼ ãµã‚€ãµã‚€â€¦</p>
        <p><strong>ãªã‚“ã ã‹ã‚‚ã†å°‘ã—ç™Œã®ã“ã¨ãŒçŸ¥ã‚ŠãŸããªã£ã¦ããŸï¼ï¼å•é¡Œã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¦ã¿ã‚ˆã†</strong></p>
      </div>

      <div id="story" class="lead" style="margin-bottom:8px;"></div>
      <div style="text-align:center; margin:10px 0;">
        <img id="quiz-img" src="mame2.png" alt="ã¨ã›ã„ãã‚“" style="max-width:140px; border-radius:14px; box-shadow:0 4px 12px rgba(0,0,0,0.1);" />
      </div>
      <div id="q-title" class="question"></div>
      <div id="choices" class="choices"></div>
      <div id="judge" class="result"></div>
      <div id="explain" class="explain" style="display:none;"></div>
      <div id="next-area" style="display:none; margin-top:12px;">
        <button id="next-btn" class="btn" onclick="goNext()">æ¬¡ã¸</button>
      </div>
    </section>

    <!-- 8ãƒšãƒ¼ã‚¸ç›®ï¼šãƒãƒ¼ãƒ ç´¹ä»‹ãƒ»å°å…¥ -->
    <section id="screen-teams-intro" class="card fade" style="display:none;">
      <div class="hero">
        <img src="toseikirakira.png" alt="ã‚­ãƒ©ã‚­ãƒ©ã¨ã›ã„ãã‚“" />
        <div class="speech">
          <strong>ã§ã¯ãŠå¾…ã¡ã‹ã­ã®å‡ºå ´ãƒãƒ¼ãƒ ã®ç´¹ä»‹ã ï¼ï¼</strong>
        </div>
      </div>
      <div style="margin-top:14px; text-align:center;">
        <button class="btn" onclick="startTeams()">æ¬¡ã¸</button>
      </div>
    </section>

    <!-- 9ã€œ16ãƒšãƒ¼ã‚¸ç›®ï¼šå„ãƒãƒ¼ãƒ ï¼ˆå‹•çš„è¡¨ç¤ºï¼‰ -->
    <section id="screen-team-detail" class="card fade" style="display:none;">
      <div class="hero">
        <img src="mame2.png" alt="ã¨ã›ã„ãã‚“" />
        <div class="speech">
          <div id="team-title" class="question" style="margin:0;"></div>
          <div id="team-body" class="lead" style="margin-top:8px;"></div>
        </div>
      </div>
      <div style="margin-top:14px; text-align:center;">
        <button class="btn" id="team-next-btn" onclick="nextTeam()">æ¬¡ã¸</button>
      </div>
    </section>

    <!-- æœ€çµ‚ãƒšãƒ¼ã‚¸ï¼šå…¨ãƒãƒ¼ãƒ ä¸€è¦§ãƒ»ç· ã‚ -->
    <section id="screen-ending" class="card fade" style="display:none;">
      <div class="ending-wrap">
        <div class="ending-title">ğŸ‘ ä»¥ä¸ŠãŒå‡ºå ´ãƒãƒ¼ãƒ ã ï¼</div>
        <img src="nazotoki.png" alt="ã¨ã›ã„ãã‚“" class="tarot-hero" />
        <div class="ending-lines">
          <div class="ending-badge">TMCå‡ºå ´ãƒãƒ¼ãƒ ä¸€è¦§</div>
          <ul id="team-list" style="text-align:left; margin:8px 0 0; padding-left:18px;"></ul>
          <div style="margin-top:8px;">
            ã¿ã‚“ãªã¯ã©ã®ãƒãƒ¼ãƒ ã‚’å¿œæ´ã™ã‚‹ï¼Ÿ å®Ÿã¯<strong>ç¬¬ï¼•å¼¾</strong>ã§æŠ•ç¥¨ã—ã¦ã‚‚ã‚‰ãŠã†ã¨æ€ã£ã¦ã‚‹ã‚“ã <br>
            ä¸Šä½ãƒãƒ¼ãƒ ã«ã¯TMCã§ä½¿ãˆã‚‹<strong>ã‚¢ã‚¤ãƒ†ãƒ </strong>ã‚’è´ˆå‘ˆã—ã¡ã‚ƒãŠã†ã‹ãªï¼Ÿ<br>
            ã§ã¯æ¬¡ã¾ã§<strong>ã”ãã’ã‚“ã‚ˆã†ã€‚</strong>
          </div>
        </div>
        <div class="ending-actions">
          <button class="btn ghost" id="finish-btn">ä»Šå›ã®èª¿æŸ»ã‚’çµ‚äº†ã™ã‚‹</button>
        </div>
        <div id="finish-message" style="display:none; margin-top:10px; font-weight:800; color:#374151;">
          ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚æ¬¡å›ç¬¬ï¼•å¼¾ã®æŠ•ç¥¨ã‚’ãŠæ¥½ã—ã¿ã«ã€‚
        </div>
      </div>
      <div class="confetti" id="confetti"></div>
      <div class="sparkles" id="sparkles"></div>
    </section>
  </div>

  <!-- ã‚¹ã‚¿ãƒ³ãƒ— -->
  <div id="stamp" class="stamp" aria-hidden="true">
    <img src="nazotoki.png" alt="æ­£è§£ã‚¹ã‚¿ãƒ³ãƒ—" />
  </div>

  <!-- éŸ³æº -->
  <audio id="bgmAnnounce" src="nazotoki2.mp3" preload="none" loop></audio>
  <audio id="bgmTeams" src="hajimari.mp3" preload="none" loop></audio>
  <audio id="seClick" src="pochi.mp3" preload="auto"></audio>
  <audio id="seApplause" src="seikou.mp3" preload="auto"></audio>
  <audio id="seCorrect" src="pinpon.mp3" preload="auto"></audio>

<script>
/* ====== åˆæœŸã‚»ãƒƒãƒˆ ====== */
const GOOGLE_FORM_ACTION = ""; // å¿…è¦ãªã‚‰URLã‚’å…¥ã‚Œã¦æœ‰åŠ¹åŒ–
const ENTRY_NAME = "entry.name";
const ENTRY_DEPT = "entry.dept";
const ENTRY_JOB  = "entry.job";

function sendToGoogleForm({ name, dept, job }) {
  if(!GOOGLE_FORM_ACTION) return; // æœªè¨­å®šãªã‚‰é€ä¿¡ã—ãªã„
  const fd = new FormData();
  fd.append(ENTRY_NAME, name);
  fd.append(ENTRY_DEPT, dept);
  fd.append(ENTRY_JOB, job);
  fetch(GOOGLE_FORM_ACTION, { method: "POST", body: fd, mode: "no-cors" });
}

const nameEl  = document.getElementById('name');
const groupEl = document.getElementById('group');
const jobEl   = document.getElementById('job');

const screenIntro = document.getElementById('screen-intro');
const screenAnn   = document.getElementById('screen-announce');
const screenZodiac= document.getElementById('screen-zodiac');
const screenDiagResult = document.getElementById('screen-diag-result');
const screenQuiz  = document.getElementById('screen-quiz');
const screenTeamsIntro = document.getElementById('screen-teams-intro');
const screenTeamDetail = document.getElementById('screen-team-detail');
const screenEnding= document.getElementById('screen-ending');

function hideAll(){ [screenIntro,screenAnn,screenZodiac,screenDiagResult,screenQuiz,screenTeamsIntro,screenTeamDetail,screenEnding].forEach(e=>e.style.display='none'); }
function show(el){ hideAll(); el.style.display='block'; window.scrollTo({top:0,behavior:'smooth'}); }
show(screenIntro);

/* ====== ã‚µã‚¦ãƒ³ãƒ‰ ====== */
const bgmAnnounce = document.getElementById('bgmAnnounce');
const bgmTeams = document.getElementById('bgmTeams');
const seApplause = document.getElementById('seApplause');
const seClick = document.getElementById('seClick');
const seCorrect = document.getElementById('seCorrect');

document.addEventListener('click', e=>{
  const btn = e.target.closest('button');
  if(!btn) return;
  if(btn.classList.contains('choice-btn')) return;
  try{ seClick.currentTime = 0; seClick.play(); }catch(e){}
}, true);

/* ====== 1 â†’ 2ï¼šã‚¿ã‚¤ãƒ—ãƒ©ã‚¤ã‚¿ãƒ¼æ¼”å‡º ====== */
const L1 = "TMCãƒã‚¹ã‚³ãƒƒãƒˆã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ã¨ã›ã„ãã‚“ã ã‚ˆã€‚ä»Šæ—¥ã¯ã¿ã‚“ãªã«å¬‰ã—ã„ãŠçŸ¥ã‚‰ã›ãŒã‚ã‚‹ã‚“ã ã€‚";
const L2 = "ãªã‚“ã¨TMCã®å‡ºå ´ãƒãƒ¼ãƒ ãŒæ±ºã¾ã£ãŸã‚ˆï¼ï¼";
const L3 = "è¬è§£ãã®å¾Œã«å‡ºå ´ãƒãƒ¼ãƒ ã®ç´¹ä»‹ã‚’ã—ã‚ˆã†ã¨æ€ã£ã¦ã‚‹ã€‚ã©ã‚“ãªãƒãƒ¼ãƒ ãŒå‡ºã‚‹ã®ã‹æ¥½ã—ã¿ã ã­ã€‚";

function typeLine(el, text, speed=28){
  return new Promise(resolve=>{
    el.textContent = "";
    let i=0;
    const timer = setInterval(()=>{
      el.textContent += text[i++];
      if(i>=text.length){ clearInterval(timer); resolve(); }
    }, speed);
  });
}

window.goPre = function(){
  if(!nameEl.value.trim()){ nameEl.focus(); nameEl.style.borderColor='#ff8dc7'; return; }
  nameEl.style.borderColor='#ffdff0';
  sendToGoogleForm({ name: nameEl.value, dept: groupEl.value, job: jobEl.value });
  // BGMé–‹å§‹ï¼ˆ2ãƒšãƒ¼ã‚¸ç›®ã§æµã™ï¼‰
  try{ bgmAnnounce.volume = 0.85; bgmAnnounce.play(); }catch(e){}
  show(screenAnn);
  // ã‚»ãƒªãƒ•é †ç•ªã«
  (async ()=>{
    const el1 = document.getElementById('typeL1');
    const el2 = document.getElementById('typeL2');
    const el3 = document.getElementById('typeL3');
    await typeLine(el1, L1);
    await new Promise(r=>setTimeout(r, 3000)); // 3ç§’å¾…æ©Ÿ
    await typeLine(el2, L2);
    try{ seApplause.currentTime = 0; seApplause.play(); }catch(e){}
    await new Promise(r=>setTimeout(r, 600));
    await typeLine(el3, L3);
    document.getElementById('to-zodiac-btn').disabled = false;
  })();
};

window.toZodiac = function(){
  show(screenZodiac);
};

/* ====== 3 â†’ 4ï¼šæ˜Ÿåº§å ã„ ====== */
const typeTitleEl = document.getElementById('type-title');
const typeCopyEl = document.getElementById('type-copy');
const fortuneLinesEl = document.getElementById('fortune-lines');
const adviceTitleEl = document.getElementById('advice-title');
const typeDescEl = document.getElementById('type-desc');

function renderFortune(lines){
  fortuneLinesEl.innerHTML = "";
  let i = 0;
  (function next(){
    if(i >= lines.length) return;
    const div = document.createElement('div');
    div.className = 'type-line';
    div.textContent = lines[i++];
    fortuneLinesEl.appendChild(div);
    setTimeout(next, 900);
  })();
}
function showAdviceTitle(){ adviceTitleEl.style.display='block'; }

const zodiacData = {
  aries:{label:"ãŠã²ã¤ã˜åº§ï¼ˆAriesï¼‰",keyword:"ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã¨ã‚¹ã‚¿ãƒ¼ãƒˆ",lines:["2025å¹´12æœˆã¯ã€ã€ã‚„ã£ã¦ã¿ã‚ˆã†ï¼ã€ã®ä¸€æ­©ãŒå¤§ããªæˆé•·ã«ã€‚","æ–°ã—ã„ä¿‚ã‚„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æ‰‹ã‚’æŒ™ã’ã‚‹ã¨æ¥½ã—ã„å±•é–‹ã«ã€‚","è¡Œå‹•åŠ›ãŒãƒãƒ¼ãƒ ã‚’å‰ã«é€²ã‚ã‚‹ã‚ˆã€‚"],tips:["æ°—ã«ãªã‚‹ç ”ä¿®ã«1ã¤å‚åŠ ã€‚","å°ã•ãªç›®æ¨™ã‚’æ±ºã‚ã¦å–ã‚Šçµ„ã‚€ã€‚"]},
  taurus:{label:"ãŠã†ã—åº§ï¼ˆTaurusï¼‰",keyword:"ã˜ã£ãã‚Šæ•´ãˆã‚‹",lines:["ç’°å¢ƒã‚’æ•´ãˆã‚‹ã»ã©é‹æ°—ã‚¢ãƒƒãƒ—ã€‚","ç‰‡ã¥ã‘ã§ãƒŸã‚¹ã‚‚æ¸›ã£ã¦ã‚¹ãƒƒã‚­ãƒªã€‚","ä¸å¯§ã•ãŒä¿¡é ¼ã«ã¤ãªãŒã‚‹ã€‚"],tips:["1æ—¥5åˆ†ç‰‡ã¥ã‘ã€‚","æ›¸é¡ã‚„ãƒ¡ãƒ¢ã¯1ã‹æ‰€ã«ã€‚"]},
  gemini:{label:"ãµãŸã”åº§ï¼ˆGeminiï¼‰",keyword:"ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³",lines:["ã€ã¡ã‚‡ã£ã¨ä¸€è¨€ã€ãŒå‘¨ã‚Šã‚’æ˜ã‚‹ãã€‚","é›‘è«‡ã‹ã‚‰æ–°ã—ã„é€£æºãŒç”Ÿã¾ã‚Œãã†ã€‚","èª¬æ˜ã®ã‚ã‹ã‚Šã‚„ã™ã•ãŒå…‰ã‚‹ã€‚"],tips:["1æ—¥1å›ã‚ã‚ŠãŒã¨ã†ã€‚","ã‚«ãƒ³ãƒ•ã‚¡ã§è³ªå•ã‚’1ã¤ã€‚"]},
  cancer:{label:"ã‹ã«åº§ï¼ˆCancerï¼‰",keyword:"ã‚„ã•ã—ã•ã¨å®‰å¿ƒæ„Ÿ",lines:["ã€èãåŠ›ã€ãŒå¤§ããªæ”¯ãˆã«ã€‚","æœ¬éŸ³ã‚’å¼•ãå‡ºã™èãå½¹ã§æ´»èºã€‚","ã‚»ãƒ«ãƒ•ã‚±ã‚¢ã‚‚å¿˜ã‚Œãšã«ã€‚"],tips:["1æ—¥ã®çµ‚ã‚ã‚Šã«ã€ã§ããŸã“ã¨ã€ã‚’3ã¤ã€‚","æ¸©ã‹ã„é£²ã¿ç‰©ã§ä¸€æ¯ã€‚"]},
  leo:{label:"ã—ã—åº§ï¼ˆLeoï¼‰",keyword:"ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—",lines:["è‡ªç„¶ã¨å¼•ã£å¼µã‚‹å½¹å‰²ãŒå›ã£ã¦ããã†ã€‚","å‰å‘ããªä¸€è¨€ãŒé›°å›²æ°—ã‚’æ˜ã‚‹ãã€‚","ç¬‘é¡”ã§é€²ã‚€å§¿ãŒå‹‡æ°—ã«ãªã‚‹ã€‚"],tips:["å›°ã£ã¦ã„ã‚‹äººã«å£°ã‹ã‘ã€‚","ã‚«ãƒ³ãƒ•ã‚¡ã§æ„è¦‹ã‚’1ã¤ã€‚"]},
  virgo:{label:"ãŠã¨ã‚åº§ï¼ˆVirgoï¼‰",keyword:"ä¸å¯§ã•ã¨å·¥å¤«",lines:["ã€ä¸€æ‰‹é–“ã€ã®å·¥å¤«ãŒå…‰ã‚‹æœˆã€‚","æ•´ç†ã‚„ãƒã‚§ãƒƒã‚¯ãŒåŠ©ã‘ã«ã€‚","è¦³å¯ŸåŠ›ã®é«˜ã•ãŒå®‰å…¨ã«ã¤ãªãŒã‚‹ã€‚"],tips:["ãƒŸãƒ‹ãƒ¡ãƒ¢ã‚’ä½œã‚‹ã€‚","æ°—ã¥ã„ãŸå·¥å¤«ã‚’å…±æœ‰ã€‚"]},
  libra:{label:"ã¦ã‚“ã³ã‚“åº§ï¼ˆLibraï¼‰",keyword:"ãƒãƒ©ãƒ³ã‚¹ã¨èª¿æ•´",lines:["ãƒ¯ãƒ¼ã‚¯ãƒ©ã‚¤ãƒ•ã®è¦‹ç›´ã—ã«æœ€é©ã€‚","äººã«é ¼ã‚‹é¸æŠã‚‚å¤§åˆ‡ã€‚","ã‚ãªãŸã®èª¿æ•´åŠ›ã§ä¸¸ãåã¾ã‚‹ã€‚"],tips:["ä¼‘ã‚€æ™‚é–“ã‚’å…ˆã«æ±ºã‚ã‚‹ã€‚","ä¿¡é ¼ã§ãã‚‹äººã«ç›¸è«‡ã€‚"]},
  scorpio:{label:"ã•ãã‚Šåº§ï¼ˆScorpioï¼‰",keyword:"æ·±ãå‘ãåˆã†",lines:["èƒŒæ™¯ã«ç›®ã‚’å‘ã‘ã‚‹ã¨æ°—ã¥ããŒå¢—ãˆã‚‹ã€‚","ä¾¡å€¤è¦³ã‚’çŸ¥ã‚‹ãƒãƒ£ãƒ³ã‚¹ã€‚","ã˜ã£ãã‚Šå§¿å‹¢ãŒå®‰å¿ƒæ„Ÿã«ã€‚"],tips:["ã€ä¸€ç•ªä¸å®‰ã¯ï¼Ÿã€ã‚’èãã€‚","â€œãã®äººã‚‰ã—ã•â€ã‚’ä¸€è¨€ãƒ¡ãƒ¢ã€‚"]},
  sagittarius:{label:"ã„ã¦åº§ï¼ˆSAGITTARIUSï¼‰",keyword:"å­¦ã³ã¨å†’é™º",lines:["æ–°ã—ã„çŸ¥è­˜ã®å¸åã«æœ€é©ã€‚","ãŒã‚“ãƒ»ç·©å’Œãƒ»é€£æºã®æ·±æ˜ã‚Šâ—ã€‚","å­¦ã‚“ã ã‚‰ã™ãè©¦ã™ã¨è‡ªä¿¡ã«ã€‚"],tips:["ãƒ†ãƒ¼ãƒã‚’æ±ºã‚ã¦èª¿ã¹ã‚‹ã€‚","å­¦ã³ã‚’1ã¤ã‚·ã‚§ã‚¢ã€‚"]},
  capricorn:{label:"ã‚„ãåº§ï¼ˆCapricornï¼‰",keyword:"ã‚³ãƒ„ã‚³ãƒ„",lines:["å°ã•ãªåŠªåŠ›ãŒå®Ÿã‚’çµã¶æœˆã€‚","è‹¦æ‰‹ã‚‚å°‘ã—ãšã¤æ…£ã‚Œã¦ã„ã‘ã‚‹ã€‚","çœŸé¢ç›®ã•ã¨è²¬ä»»æ„Ÿã¯è¦‹ã‚‰ã‚Œã¦ã„ã‚‹ã€‚"],tips:["ä»Šæ—¥ã®ãƒ†ãƒ¼ãƒã‚’1ã¤æ±ºã‚ã‚‹ã€‚","ã§ããŸã‚‰æ‰‹å¸³ã«ãƒã‚§ãƒƒã‚¯ã€‚"]},
  aquarius:{label:"ã¿ãšãŒã‚åº§ï¼ˆAquariusï¼‰",keyword:"ã‚¢ã‚¤ãƒ‡ã‚¢ã¨ã¤ãªãŒã‚Š",lines:["ã€ã‚‚ã£ã¨è‰¯ããªã‚‹ã‹ã‚‚ï¼Ÿã€ãŒå¢—ãˆã‚‹æœˆã€‚","æ–°ã—ã„å–ã‚Šçµ„ã¿ææ¡ˆã«â—ã€‚","ã‚„ã‚Šæ–¹ã«å°‘ã—ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’è¿½åŠ ã€‚"],tips:["æ”¹å–„æ¡ˆã‚’ãƒ¡ãƒ¢â†’å…±æœ‰ã€‚","ä»–è·ç¨®ã®è©±ã‚’èãã€‚"]},
  pisces:{label:"ã†ãŠåº§ï¼ˆPiscesï¼‰",keyword:"å…±æ„Ÿã¨ã‚„ã•ã—ã•",lines:["ã‚„ã‚ã‚‰ã‹ã„é›°å›²æ°—ãŒç™’ã—ã«ã€‚","å¯„ã‚Šæ·»ã„ã§å¤§ããªå®‰å¿ƒã€‚","ã‚»ãƒ«ãƒ•ã‚±ã‚¢ã‚‚å¿˜ã‚Œãšã«ã€‚"],tips:["å…±æ„Ÿã®ä¸€è¨€ã‚’æ„è­˜ã€‚","è‡ªåˆ†ã®æ°—æŒã¡ã‚‚è©±ã™ã€‚"]}
};

window.selectZodiac = function(key){
  const data = zodiacData[key]; if(!data) return;
  typeTitleEl.textContent = "ã¨ã›ã„ãã‚“ã®æ˜Ÿåº§å ã„ï¼š2025å¹´12æœˆ";
  typeCopyEl.textContent  = `${data.label} ã•ã‚“ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼šã€Œ${data.keyword}ã€`;
  renderFortune(data.lines);
  typeDescEl.innerHTML = "";
  data.tips.forEach(t=>{ const li=document.createElement('li'); li.textContent="ğŸ”¸ "+t; typeDescEl.appendChild(li); });
  adviceTitleEl.style.display='block';
  show(screenDiagResult);
};

/* ====== ã‚¯ã‚¤ã‚º ====== */
const stampEl = document.getElementById('stamp');
const storyEl = document.getElementById('story');
const qTitleEl = document.getElementById('q-title');
const choicesEl = document.getElementById('choices');
const judgeEl = document.getElementById('judge');
const explainEl = document.getElementById('explain');
const nextArea = document.getElementById('next-area');
const quizImgEl = document.getElementById('quiz-img');
const quizPrologueEl = document.getElementById('quiz-prologue');

const quiz = [
  {
    story: "ğŸ¦€ ã“ã“ã‹ã‚‰ã¯ã€ŒãŒã‚“ã®æ¨™æº–æ²»ç™‚ã€ã«ã¤ã„ã¦ã®ãªãã ã‚ˆã€‚",
    title: "è¬1ï¼šãŒã‚“æ¨™æº–æ²»ç™‚ã®ã€Œ3å¤§æ²»ç™‚ã€ã¨ã¯ãªã«ã‹ãªã€‚é•ã†ã‚‚ã®ãŒ1ã¤å…¥ã£ã¦ã„ã‚‹ã‚ˆã€‚ã©ã‚Œã‹ãªï¼Ÿ",
    choices: [
      {label:"1ï¼‰åŒ–å­¦ç™‚æ³•", correct:false},
      {label:"2ï¼‰ç·©å’Œã‚±ã‚¢ç™‚æ³•", correct:true},
      {label:"3ï¼‰æ‰‹è¡“ç™‚æ³•", correct:false},
      {label:"4ï¼‰æ”¾å°„ç·šç™‚æ³•", correct:false}
    ],
    explain: [
      "æ­£è§£ã¯ â‘¡ ç·©å’Œã‚±ã‚¢ç™‚æ³•ã€‚",
      "ãŒã‚“ã®æ¨™æº–æ²»ç™‚ã¨ã¯ã€ç§‘å­¦çš„æ ¹æ‹ ã«åŸºã¥ãã€æœ‰åŠ¹æ€§ã¨å®‰å…¨æ€§ãŒèªã‚ã‚‰ã‚Œã¦ã„ã‚‹æ²»ç™‚æ³•ã®ã“ã¨ã€‚",
      "ä¸»ãªã‚‚ã®ã«ã€Œæ‰‹è¡“ã€ã€Œè–¬ç‰©ç™‚æ³•ï¼ˆåŒ–å­¦ç™‚æ³•ãªã©ï¼‰ã€ã€Œæ”¾å°„ç·šç™‚æ³•ã€ãŒã‚ã‚Šã€ã“ã‚Œã‚‰ã‚’ã€ŒãŒã‚“ã®ä¸‰å¤§æ²»ç™‚ã€ã¨å‘¼ã¶ã‚ˆã€‚"
    ]
  },
  {
    story: "ğŸŒ¸ æ¬¡ã¯ã€Œç·©å’Œã‚±ã‚¢ã€ã«ã¤ã„ã¦ã®ãªãã ã‚ˆã€‚",
    title: "è¬2ï¼šã€Œç·©å’Œã‚±ã‚¢ã€ã«ã¤ã„ã¦æ­£ã—ãèª¬æ˜ã—ã¦ã„ã‚‹ã®ã¯ã©ã‚Œï¼Ÿ",
    choices: [
      {label:"1ï¼‰æœ€çµ‚æœ«æœŸã®ã¤ã‚‰ã„ç—‡çŠ¶ã‚’ç·©å’Œã™ã‚‹ã‚±ã‚¢", correct:false},
      {label:"2ï¼‰åŒ»å¸«ã¨çœ‹è­·å¸«ã€è–¬å‰¤å¸«ã®ã¿ã§æ§‹æˆã•ã‚ŒãŸãƒãƒ¼ãƒ ãŒã‚ã‚‹", correct:false},
      {label:"3ï¼‰çµŒæ¸ˆé¢ã§ã®æ”¯æ´ã¯ç·©å’Œã‚±ã‚¢ã®å¯¾è±¡ã§ã¯ãªã„", correct:false},
      {label:"4ï¼‰ãŒã‚“ã¨è¨ºæ–­ã•ã‚ŒãŸæ™‚ã‹ã‚‰ã€æ²»ç™‚ã¨ä¸¦è¡Œã—ã¦å—ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹", correct:true}
    ],
    explain: [
      "æ­£è§£ã¯ â‘£ã€‚",
      "ç·©å’Œã‚±ã‚¢ã¯ã€ç—…æ°—ã®æ—©æœŸã‹ã‚‰ã€ãŒã‚“æ²»ç™‚ã¨ä¸¦è¡Œã—ã¦è¡Œã‚ã‚Œã‚‹ã‚‚ã®ã§ã‚ã‚Šã€çµ‚æœ«æœŸã«é™ã‚‰ã‚Œã‚‹ã‚‚ã®ã§ã¯ãªã„ã‚ˆã€‚",
      "ç·©å’Œã‚±ã‚¢ãƒãƒ¼ãƒ ã«ã¯åŒ»å¸«ãƒ»çœ‹è­·å¸«ãƒ»è–¬å‰¤å¸«ã®ã»ã‹ã€å¤šãã®å°‚é–€è·ãŒå‚ç”»ï¼ é™¶ç”Ÿç—…é™¢ã§ã‚‚é€±1å›ã‚«ãƒ³ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚’è¡Œã£ã¦ã„ã‚‹ã‚ˆã€‚"
    ]
  },
  {
    story: "ğŸ¤ æœ€å¾Œã¯ã€Œå¤šè·ç¨®é€£æºã€ã¨ãƒãƒ¼ãƒ åŒ»ç™‚ã®ãªãã ã‚ˆã€‚",
    title: "è¬3ï¼šãŒã‚“æ‚£è€…ãŒæŠ±ãˆã‚‹ã‚ã‚‰ã‚†ã‚‹å•é¡Œã«å¯¾å¿œã—ã¦ã„ããŸã‚ã«ã¯ã€å¤šè·ç¨®é€£æºãŒã™ã£ã”ãå¤§äº‹ã€‚ãƒãƒ¼ãƒ åŒ»ç™‚ã«å«ã¾ã‚Œã‚‹ã®ã¯èª°ï¼Ÿ",
    choices: [
      {label:"1ï¼‰æ‚£è€…ãƒ»å®¶æ—", correct:false},
      {label:"2ï¼‰åœ°åŸŸã®åœ¨å®…åŒ»ç™‚åŒ»å¸«ã‚„è¨ªå•çœ‹è­·å¸«", correct:false},
      {label:"3ï¼‰ã‚±ã‚¢ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼", correct:false},
      {label:"4ï¼‰å…¨éƒ¨ã‚ã¦ã¯ã¾ã‚‹", correct:true}
    ],
    explain: [
      "æ­£è§£ã¯ â‘£ å…¨éƒ¨ã‚ã¦ã¯ã¾ã‚‹ã€‚",
      "ç—…é™¢ã®ä¸­ã®ã‚¹ã‚¿ãƒƒãƒ•ã ã‘ã§ãªãã€æ‚£è€…ã•ã‚“æœ¬äººãƒ»å®¶æ—ã€åœ°åŸŸã®ã‹ã‹ã‚Šã¤ã‘åŒ»ã‚„è¨ªå•çœ‹è­·å¸«ã€ã‚±ã‚¢ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãªã©ã€ãŸãã•ã‚“ã®ãƒ¡ãƒ³ãƒãƒ¼ãŒãƒãƒ¼ãƒ åŒ»ç™‚ã®ä»²é–“ã ã‚ˆã€‚",
      "é€€é™¢å¾Œã‚‚ã‚¹ãƒ ãƒ¼ã‚ºãªç™‚é¤Šç”Ÿæ´»ã‚’é€ã‚Œã‚‹ã‚ˆã†ã«ã€ç—…é™¢ã¨åœ°åŸŸãŒã¤ãªãŒã£ã¦æ”¯ãˆã¦ã„ãã“ã¨ãŒãƒã‚¤ãƒ³ãƒˆï¼"
    ]
  }
];
let quizIndex = 0;

function toQuiz(){
  quizIndex=0;
  renderQuiz();
  // ãƒ—ãƒ­ãƒ­ãƒ¼ã‚°ã¯1å•ç›®çªå…¥æ™‚ã®ã¿è¡¨ç¤º
  quizPrologueEl.style.display = "block";
  show(screenQuiz);
}

function renderQuiz(){
  const q = quiz[quizIndex];
  // 1å•ç›®ä»¥å¤–ã§ã¯ãƒ—ãƒ­ãƒ­ãƒ¼ã‚°ã‚’éš ã™
  if(quizIndex === 0){ quizPrologueEl.style.display = "block"; }
  else{ quizPrologueEl.style.display = "none"; }

  storyEl.innerHTML = q.story;
  qTitleEl.textContent = q.title;
  choicesEl.innerHTML = "";
  judgeEl.textContent = "";
  explainEl.style.display = "none";
  explainEl.innerHTML = "";
  nextArea.style.display = "none";
  q.choices.forEach(c=>{
    const b=document.createElement('button');
    b.className='choice-btn';
    b.textContent=c.label;
    b.onclick=()=>judge(c.correct);
    choicesEl.appendChild(b);
  });
}
function showStamp(){ const s=document.getElementById('stamp'); s.style.display='flex'; setTimeout(()=>s.style.display='none',700); }
function judge(ok){
  if(ok){
    judgeEl.textContent="æ­£è§£ï¼"; judgeEl.className="result ok";
    try{ seCorrect.currentTime=0; seCorrect.play(); }catch(e){}
    showStamp();
    const q=quiz[quizIndex];
    explainEl.innerHTML="<strong>è§£èª¬</strong><ul style='margin:6px 0 0; padding-left:18px;'>"+ q.explain.map(t=>"<li>"+t+"</li>").join("") +"</ul>";
    explainEl.style.display="block"; nextArea.style.display="block";
  }else{
    judgeEl.textContent="æ®‹å¿µï¼ã‚‚ã†ä¸€åº¦é¸ã‚“ã§ã¿ã‚ˆã†ã€‚"; judgeEl.className="result ng";
  }
}
function goNext(){
  quizIndex++;
  if(quizIndex<quiz.length){ renderQuiz(); window.scrollTo({top:0,behavior:'smooth'});}
  else{
    // ãƒãƒ¼ãƒ ç´¹ä»‹ã¸ï¼šBGMåˆ‡æ›¿
    try{ bgmAnnounce.pause(); }catch(e){}
    try{ bgmTeams.volume=0.9; bgmTeams.play(); }catch(e){}
    show(screenTeamsIntro);
  }
}

/* ====== ãƒãƒ¼ãƒ ç´¹ä»‹ ====== */
const teams = [
  { name:"ãƒãƒ¼ãƒ 5N",
    desc:"åƒ•ãŒå¯Ÿã™ã‚‹ã«ã“ã‚Œã¯5Nç—…æ£Ÿä¸­å¿ƒã®ãƒãƒ¼ãƒ ã ã­ã€‚æ„æ°—è¾¼ã¿ã¯ã€Œã¿ã‚“ãªã§å”åŠ›ã—ã¦é ‘å¼µã‚Šã¾ã™ã€‚ã€ã ã£ã¦ã€‚ã“ã‚Œã¯å¼·ãã†ã ã­ã€‚" },
  { name:"å¤–ç§‘ã®ä¸€å‘³",
    desc:"æ–‡å­—é€šã‚Šå¤–ç§‘ç—…æ£Ÿã®ãƒãƒ¼ãƒ ã‹ãªã€‚ä¸€å‘³ã¨ã„ã†ã“ã¨ã¯å¤šè·ç¨®æ··åˆãƒãƒ¼ãƒ ã‹ãªã‚ã€‚ã“ã‚Œã¯å¼·ãã†ã ã€‚æ„æ°—è¾¼ã¿ã¯ã€Œãƒ¡ã‚¹ã®ã‚ˆã†ãªåˆ‡ã‚Œå‘³ã§é ‘å¼µã‚Šã¾ã™ã€‚ã€ã ã£ã¦ã€‚ã“ã‚Œã¯å¼·ãã†ã ã­ã€‚" },
  { name:"Team BONE",
    desc:"BONEã¨ã„ã†ã“ã¨ã¯éª¨ã¨ã„ã†ã“ã¨ã ã‚ˆã­ã€‚ã“ã‚Œã¯éª¨å¹¹ãŒã—ã£ã‹ã‚Šã—ã¦ã„ã¦å¼·ãã†ã ã€‚æ„æ°—è¾¼ã¿ã¯ã€Œå”åŠ›ã—ã¦é ‘å¼µã‚Šã¾ã™ã€‚ã€ã ã£ã¦ã€‚é–“é•ã„ãªãå¼·ã„ã­ã€‚" },
  { name:"ã¨ã†ã›ã„å‹æ‰‹ã«ç››ã‚Šä¸Šã’éšŠ",
    desc:"ã“ã‚Œã¯è¬ã®ãƒãƒ¼ãƒ ã ã­ã€‚ã§ã‚‚ã¨ã†ã›ã„ã‚’ç››ã‚Šä¸Šã’ã‚ˆã†ã¨ã™ã‚‹æ„æ¬²ã®ã‚ã‚‹äººãŸã¡ã ã‹ã‚‰çµ¶å¯¾ã«å¼·ã„ã­ã€‚æ„æ°—è¾¼ã¿ã¯ã€Œã¨ã†ã›ã„ã‚’ç››ã‚Šä¸Šã’ã¾ã™ã€‚ã€ã ã£ã¦ã€‚ç››ã‚Šä¸ŠãŒã‚‹ã“ã¨é–“é•ã„ãªã—ã ã­ã€‚" },
  { name:"å¸«é•·ä¼šY",
    desc:"ã“ã‚Œã¯çœ‹è­·å¸«é•·ã®ãƒãƒ¼ãƒ ã‹ãªï¼ŸYã£ã¦ã©ã‚“ãªæ„å‘³ã ã‚ã€‚èª°ã‹ã®ã‚¤ãƒ‹ã‚·ãƒ£ãƒ«ãªã®ã‹ãªï¼Ÿæ„æ°—è¾¼ã¿ã¯ã€Œå¸«é•·å”åŠ›ã—ã¦é ‘å¼µã‚Šã¾ã™ã€‚ã€ã ã£ã¦ã€‚å¸«é•·ãƒ‘ãƒ¯ãƒ¼ãŒç‚¸è£‚ã—ãã†ã ã­ã€‚" },
  { name:"ãƒãƒ¼ãƒ ä¿ç•™",
    desc:"åƒ•ãŒå¯Ÿã™ã‚‹ã«ã“ã‚Œã¯ç—…æ£Ÿä¸­å¿ƒã®ãƒãƒ¼ãƒ ã ã­ã€‚æ„æ°—è¾¼ã¿ã¯ã€Œã¿ã‚“ãªã§é ‘å¼µã‚Šã¾ã™ã€‚ã€ã ã£ã¦ã€‚ã“ã‚Œã¯å¼·ãã†ã ã­ã€‚" },
  { name:"ãƒãƒ¼ãƒ ã“ã‚Œã‹ã‚‰æ±ºã‚ã¾ã™",
    desc:"åƒ•ãŒå¯Ÿã™ã‚‹ã«ã“ã‚Œã¯ç—…æ£Ÿä¸­å¿ƒã®ãƒãƒ¼ãƒ ã ã­ã€‚æ„æ°—è¾¼ã¿ã¯ã€Œã¿ã‚“ãªã§å”åŠ›ã—ã¦é ‘å¼µã‚Šã¾ã™ã€‚ã€ã ã£ã¦ã€‚ã“ã‚Œã¯å¼·ãã†ã ã­ã€‚" },
  { name:"ICU ERICU",
    desc:"åƒ•ãŒå¯Ÿã™ã‚‹ã«ã“ã‚Œã¯ICUç—…æ£Ÿä¸­å¿ƒã®ãƒãƒ¼ãƒ ã ã­ã€‚æ„æ°—è¾¼ã¿ã¯ã€Œã¿ã‚“ãªã§å”åŠ›ã—ã¦é ‘å¼µã‚Šã¾ã™ã€‚ã€ã ã£ã¦ã€‚ã“ã‚Œã¯å¼·ãã†ã ã­ã€‚" }
];
let teamIdx = -1;
const teamTitle = document.getElementById('team-title');
const teamBody  = document.getElementById('team-body');
const teamNextBtn = document.getElementById('team-next-btn');

function startTeams(){ teamIdx=-1; nextTeam(); show(screenTeamDetail); }

function nextTeam(){
  teamIdx++;
  if(teamIdx<teams.length){
    teamTitle.textContent = `ç¬¬${teamIdx+1}ãƒãƒ¼ãƒ ç›®ã¯ã€Œ${teams[teamIdx].name}ã€ã ï¼ï¼`;
    teamBody.textContent  = teams[teamIdx].desc;
    if(teamIdx===teams.length-1){ teamNextBtn.textContent="æœ€å¾Œã®ãƒšãƒ¼ã‚¸ã¸"; }
    else{ teamNextBtn.textContent="æ¬¡ã¸"; }
    window.scrollTo({top:0,behavior:'smooth'});
  }else{
    // æœ€å¾Œï¼šä¸€è¦§ã¨æ‹æ‰‹
    try{ seApplause.currentTime=0; seApplause.play(); }catch(e){}
    const ul=document.getElementById('team-list');
    ul.innerHTML="";
    teams.forEach(t=>{ const li=document.createElement('li'); li.textContent=t.name; ul.appendChild(li); });
    show(screenEnding);
    launchConfetti(); launchSparkles();
  }
}

/* ====== ãƒ•ã‚£ãƒŠãƒ¼ãƒ¬æ¼”å‡º ====== */
const confettiEl = document.getElementById('confetti');
const sparklesEl = document.getElementById('sparkles');
function launchConfetti(){
  confettiEl.innerHTML = "";
  const colors = ["#ff7ac6","#ffd166","#7bdff2","#c3f0ca","#b5b0ff"];
  for(let i=0;i<42;i++){
    const s = document.createElement('span');
    const size = 8 + Math.random()*10;
    s.style.width = size + "px";
    s.style.height = (size*1.6) + "px";
    s.style.left = (Math.random()*100) + "%";
    s.style.background = colors[Math.floor(Math.random()*colors.length)];
    s.style.animationDelay = (Math.random()*0.8) + "s";
    confettiEl.appendChild(s);
  }
}
function launchSparkles(){
  sparklesEl.innerHTML = "";
  for(let i=0;i<18;i++){
    const sp = document.createElement('div');
    sp.className = 'spark';
    sp.style.left = (Math.random()*100) + "%";
    sp.style.top  = (Math.random()*100) + "%";
    sp.style.animationDelay = (Math.random()*1.2) + "s";
    sparklesEl.appendChild(sp);
  }
}
document.getElementById('finish-btn').addEventListener('click',()=>{
  try{ bgmAnnounce.pause(); }catch(e){}
  try{ bgmTeams.pause(); }catch(e){}
  const msg=document.getElementById('finish-message');
  msg.style.display='block';
  const btn=document.getElementById('finish-btn');
  btn.disabled=true; btn.textContent='çµ‚äº†ã—ã¾ã—ãŸ';
});
</script>
</body>
</html>
